---
title: "Melbourne Housing EDA"
author: "Alana Pooler"
format: html
editor: visual
---

# Data Analysis: Melbourne Housing

Import packages

```{r}
library(ggplot2)
library(tidyverse)

# surpress scientific notation
options(scipen = 999)
```

## Data Preparation

Read in and view data

```{r}
df <- read_csv('Melbourne_housing_FULL.csv', na = ('#N/A'))
df
```

Check for missing values

```{r}
sum_na <- function(column){
 sum(is.na(column))
}

df |> summarize(across(everything(), sum_na))
```

Convert categorical variables to factors where appropriate

```{r}
df <- df |>
  mutate(across(c('Type', 'Method', 'Regionname'), as.factor))
```

```{r}
# Recode 'Type' values for better readability
df <- df |>
  mutate(Type = fct_recode(Type,
          'House'       = 'h',
          'Unit/Duplex' = 'u',
          'Townhouse'   = 't'))
```

The value 0 for 'Landsize' and 'BuildingArea' doesn't make sense. Since we have plenty of data to work with and many NA values already, we will remove these values.
Additionally, since I am most interested in the 'Price' variable, let's remove rows where Price is missing. This leaves us with 8,272 rows.
```{r}
df <- df |>
  filter(Landsize != 0) |>
  filter(BuildingArea != 0) |>
  filter(!is.na(Price))
```

Building Area and Land Size are measured in meters, so let's convert the units to square feet for better interpretability. Since we are measuring land/building size, we are going to assume the original unit is square meters, rather than just meters.
```{r}
df <- df |>
  mutate(
    BuildingArea = round(BuildingArea*10.7639, 2),
    Landsize = round(Landsize*10.7639, 2)
  )
```


## Numerical Summaries

This data does not have many variables that have small enough ranges to be ideal for a contingency table, unless we create binned variables. So, let's create some binned variables.

First, look at measures of spread for home prices to get an idea of what the bins should be.
Mean price is larger than median price, indicating that this variable is skewed right.
```{r}
df |>
  summarize(
    mean_price = mean(Price, na.rm = TRUE),
    med_price = median(Price, na.rm = TRUE),
    sd_price = sd(Price, na.rm = TRUE),
    min_price = min(Price, na.rm = TRUE),
    max_price = max(Price, na.rm = TRUE))
```

Create Price Range variable
```{r}
df$PriceRange <- cut(
  df$Price,
  breaks = c(0, 300000, 600000, 900000, 1500000, 2500000, Inf),
  labels = c("0-300K", "300K-600K", "600K-900K",
             "900K-1.5M", "1.5M-2.5M", ">2.5M"),
  right = FALSE
)
```

#### Contingency Tables

Type of property:
The majority of properties are houses, followed by units/duplexes, and then townhouses closely behind.

```{r}
table(df$Type)
```

Price Range:
The 900k-1.5M group has the highest count of values, followed by the 600k-900k group, and then 1.5M-2.5M. Year built (or better yet, year of sale if we had it), would be helpful to look at along with this information.
```{r}
table(df$PriceRange)
```

Type of property by price range:
Units/Duplexes tend to be the most affordable housing type, with most being in the 300k-600k range, followed by the 600k-900k price range. Unsurprisingly, houses are the most expensive home type, with most houses being in the 900k-1.5M group. 
```{r}
df |>
  group_by(Type, PriceRange) |>
  summarize(count = n()) |>
  pivot_wider(names_from = Type, values_from = count)
```

Home Price by Region:
The metropolitan areas have the widest ranges of home prices, whereas there are several price ranges with no properties in Victoria. The southern metropolitan area looks to be the most expensive region.
```{r}
df |>
  group_by(Regionname, PriceRange) |>
  summarize(count = n()) |>
  pivot_wider(names_from = PriceRange, values_from = count)
```


#### Summary Statistics

Measures of spread: Building Area
Based on the mean and median, Building Area is slightly skewed right. Values of zero were removed, making the minimum 10.76 square feet (one square meter), which still doesn't make a ton of sense, but I'm going to leave it as is instead of trying to determine what the cutoff should be.

```{r}
df |>
  summarize(across(c('BuildingArea'), 
                   list("mean" = mean, "median" = median, 'max' = max, 'min' = min), 
                   .names = "{.fn}_{.col}"))
```

The value 479155 looks to be an outlier, so lets check the summary after removing it.
The result indicates that 479155 is an extreme outlier.
```{r}
df |>
  filter(BuildingArea < 479155) |>
  summarize(across(c('BuildingArea'), 
                   list("mean" = mean, "median" = median, 'max' = max, 'min' = min), 
                   .names = "{.fn}_{.col}"))
```


Measures of spread: Land Size
Like the building area variable, this variable is slightly skewed right. The maximum looks like it could be an outlier. 
```{r}
df |>
  summarize(across(c('Landsize'), 
                   list("mean" = mean, "median" = median, 'max' = max, 'min' = min), 
                   .names = "{.fn}_{.col}"))
```

Let's remove the potential outlier like we did for Building Area.
Removing 478993.5 only brings the max land size down to 460694.9.
```{r}
df |>
  filter(Landsize < 478993.5) |>
  summarize(across(c('Landsize'), 
                   list("mean" = mean, "median" = median, 'max' = max, 'min' = min), 
                   .names = "{.fn}_{.col}"))
```



Average and median home price by year over the last 50 years

```{r}
df |>
  filter(YearBuilt >= 1975) |>
  group_by(YearBuilt) |>
  summarize(across(c(Price), 
                   list("mean" = mean, "median" = median), 
                   .names = "{.fn}_{.col}"))
```

Average and median home price by region
This summary corroborates what we saw in the contigency table of home prices by region. We see a stark difference between home prices in metropolitan areas vs Victoria, with metro areas being more expensive. Western Victoria is the least expensive region, and Southern Metropolitan is the most expensive. 
```{r}
df |>
  group_by(Regionname) |>
  summarize(across(c(Price), 
                   list("mean" = mean, "median" = median), 
                   .names = "{.fn}_{.col}"))
```

Average and median Building Area and Land Size by Price Range
```{r}
df |> 
  group_by(PriceRange) |>
  summarize(
    mean_landsize = mean(Landsize),
    median_landsize = median(Landsize),
    mean_buildingarea = mean(BuildingArea),
    median_buildingarea = median(BuildingArea)
)
```


## Graphical Summaries

Histogram of home prices, with and without outliers

Bar chart of price range
```{r}
ggplot(df, aes(x = Price)) +
  geom_histogram(bins = 25,
                 fill = 'deepskyblue4',
                 color = 'white')  +
  labs(x = 'Home Price',
       title = 'Distribution of Home Prices')


df |>
  filter(Price < 4000000) |>
  ggplot(aes(x = Price)) +
  geom_histogram(bins = 25,
                 fill = 'deepskyblue4',
                 color = 'white') +
  labs(x = 'Home Price',
       title = 'Distribution of Home Prices')

ggplot(df, aes(x = PriceRange)) +
  geom_bar(fill = "deepskyblue4") +
  labs(x = 'Price Range',
       y = 'Count',
       title = 'Number of Properties by Price Range')
```




